like before, except with connected_callback and some other crap